{"version":3,"sources":["../../src/js/live-delphi.js"],"names":["$","widget","_create","serverConfig","getConfig","server","secure","host","port","httpProtocol","wsProtocol","console","log","serverUrl","wsUrl","element","on","proxy","_onAuthenticated","_onJoined","_onConnect","_onMessageAnswerChanged","_onMessageCommentAdded","liveDelphiClient","liveDelphiAuth","liveDelphiComment","sessionId","joinQuery","queryId","event","data","liveDelphiChart","userHash","x","y","color","parentCommentId","document","body","liveDelphi"],"mappings":"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","file":"live-delphi.js","sourcesContent":["/* global getConfig */\n\n(function(){\n  'use strict';\n  \n  $.widget(\"custom.liveDelphi\", { \n    _create : function() {\n      const serverConfig = getConfig().server;\n      const secure = serverConfig.secure;\n      const host = serverConfig.host;\n      const port = serverConfig.port;\n      const httpProtocol = secure ? 'https' : 'http';\n      const wsProtocol = secure ? 'wss' : 'ws';\n      \n      console.log(serverConfig);\n      \n      const serverUrl = httpProtocol + '://' + host + ':' + port;\n      const wsUrl = wsProtocol + '://' + host + ':' + port;\n      \n      this.element.on('authenticated', $.proxy(this._onAuthenticated, this));\n      this.element.on('joined', $.proxy(this._onJoined, this));\n      this.element.on('connect', $.proxy(this._onConnect, this));\n      this.element.on('message:answer-changed', $.proxy(this._onMessageAnswerChanged, this));\n      this.element.on('message:comment-added', $.proxy(this._onMessageCommentAdded, this));\n      \n      console.log(serverUrl);\n      \n      this.element.liveDelphiClient({\n        wsUrl: wsUrl,\n        serverUrl: serverUrl\n      });\n      \n      this.element.liveDelphiAuth({\n        serverUrl: serverUrl\n      });\n      \n      this.element.liveDelphiComment();\n      \n      this.element.liveDelphiAuth('authenticate'); \n    },\n    \n    sessionId: function () {\n      return this.element.liveDelphiAuth('sessionId');\n    },\n    \n    joinQuery: function (queryId) {\n      this.element.liveDelphiClient(\"joinQuery\", this.sessionId(), queryId);\n    },\n    \n    _onAuthenticated: function () {\n      this.element.liveDelphiAuth('join');\n    },\n    \n    _onJoined: function () {\n      this.element.liveDelphiClient('connect', this.sessionId());\n      // TODO: Move joinQuery call\n      this.joinQuery(\"2194774e-ebe9-49ce-bc6b-4e28645da40c\");\n    },\n    \n    _onConnect: function (event, data) {\n      $(\"#chart\").liveDelphiChart();\n    },\n    \n    _onMessageAnswerChanged: function (event, data) {\n      $(\"#chart\").liveDelphiChart('userData', data.userHash, {\n        x: data.x,\n        y: data.y\n      });\n    },\n    \n    _onMessageCommentAdded: function (event, data) {\n      const color = $(\"#chart\").liveDelphiChart('getColor', {\n        x: data.x,\n        y: data.y\n      }, 0);\n      \n      if (data.parentCommentId) {\n        this.element.liveDelphiComment('renderChildComment', color, data); \n      } else {\n        this.element.liveDelphiComment('renderRootComment', color, data); \n      }\n    }\n    \n  });\n  \n  $(document).on(\"deviceready\", () => {\n    $(document.body).liveDelphi();      \n  });\n  \n})();\n"]}